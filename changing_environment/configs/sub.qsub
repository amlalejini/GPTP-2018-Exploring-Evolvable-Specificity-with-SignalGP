#!/bin/bash -login

### Configure job:
#PBS -l walltime=02:00:00:00
#PBS -l feature=intel16
#PBS -l mem=8gb
#PBS -t 6001-6120
#PBS -N SGP_MapElites_Rnd2

### load necessary modules, e.g.
module load powertools

# General Parameters.
EXEC=l9_chg_env

# MAP-ELITES
S3_ES8_MIN=6001
S3_ES8_MAX=6030
S3_ES16_MIN=6031
S3_ES16_MAX=6060

# TOURNIE
S0_ES8_MIN=6061
S0_ES8_MAX=6090
S0_ES16_MIN=6091
S0_ES16_MAX=6120

RANDOM_SEED=${PBS_ARRAYID}

DATA_DIR=/mnt/scratch/lalejini/data/sgp_map_elites/data
CONFIG_DIR=/mnt/scratch/lalejini/data/sgp_map_elites/configs

########################### EVENT-DRIVEN TREATMENTS ###########################
if [ ${PBS_ARRAYID} -ge  ${S3_ES8_MIN} ]  && [ ${PBS_ARRAYID} -le  ${S3_ES8_MAX} ]; then   
  SELECTION_METHOD=3
  ENVIRONMENT_STATES=8
  SGP_PROG_MAX_FUNC_CNT=16
  SGP_PROG_MAX_FUNC_LEN=2048
  SGP_PROG_MAX_TOTAL_LEN=2048
  

elif [ ${PBS_ARRAYID} -ge  ${S3_ES16_MIN} ]  && [ ${PBS_ARRAYID} -le  ${S3_ES16_MAX} ]; then   
  SELECTION_METHOD=3
  ENVIRONMENT_STATES=16
  SGP_PROG_MAX_FUNC_CNT=32
  SGP_PROG_MAX_FUNC_LEN=4096
  SGP_PROG_MAX_TOTAL_LEN=4096


elif [ ${PBS_ARRAYID} -ge  ${S0_ES8_MIN} ]  && [ ${PBS_ARRAYID} -le  ${S0_ES8_MAX} ]; then   
  SELECTION_METHOD=0
  ENVIRONMENT_STATES=8
  SGP_PROG_MAX_FUNC_CNT=16
  SGP_PROG_MAX_FUNC_LEN=2048
  SGP_PROG_MAX_TOTAL_LEN=2048

elif [ ${PBS_ARRAYID} -ge  ${S0_ES16_MIN} ]  && [ ${PBS_ARRAYID} -le  ${S0_ES16_MAX} ]; then   
  SELECTION_METHOD=0
  ENVIRONMENT_STATES=16
  SGP_PROG_MAX_FUNC_CNT=32
  SGP_PROG_MAX_FUNC_LEN=4096
  SGP_PROG_MAX_TOTAL_LEN=4096
  
fi

RUN_NAME=S${SELECTION_METHOD}_ES${ENVIRONMENT_STATES}_FC${SGP_PROG_MAX_FUNC_CNT}_FL${SGP_PROG_MAX_FUNC_LEN}_PL${SGP_PROG_MAX_TOTAL_LEN}_${RANDOM_SEED}
RUN_DIR=${DATA_DIR}/${RUN_NAME}
# Make run directory.
mkdir -p ${RUN_DIR}
# CD to appropriate directory.
cd ${RUN_DIR}
# Copy configs here.
cp -R ${CONFIG_DIR}/* .
# Run experiment.
./${EXEC} -RANDOM_SEED ${RANDOM_SEED} -ENVIRONMENT_STATES ${ENVIRONMENT_STATES} -SELECTION_METHOD ${SELECTION_METHOD} -SGP_PROG_MAX_FUNC_CNT ${SGP_PROG_MAX_FUNC_CNT} -SGP_PROG_MAX_FUNC_LEN ${SGP_PROG_MAX_FUNC_LEN} -SGP_PROG_MAX_TOTAL_LEN ${SGP_PROG_MAX_TOTAL_LEN} > run.log